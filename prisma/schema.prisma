// npx prisma migrate reset
//npx prisma migrate dev --name init
//npx prisma db push
//npx prisma db seed

// ==============================
// GENERATOR & DATASOURCE
// ==============================
generator client {
  provider = "prisma-client"
  output   = "generated"
}

datasource db {
  provider = "postgresql"
}

// ==============================
// ENUMS
// ==============================
enum UserRole {
  USER
  LANDLORD
  ADMIN
}

model User {
  id         Int      @id @default(autoincrement())
  name       String
  email      String   @unique
  password   String
  role       UserRole   // Admin, HR, Staff
  department String   // HR, IT, Finance
  isLocked   Boolean  @default(false)   @map("is_locked")
  createdAt  DateTime @default(now())

  feedbacks   Feedback[]
  favorites   Favorite[]
  logs        ActivityLog[]
  notifications Notification[]
  versions    DocumentVersion[] @relation("UploadedVersions")

  @@map("user")
}

model Document {
  id          Int      @id @default(autoincrement())
  title       String
  description String?
  department  String
  createdAt   DateTime @default(now())

  versions     DocumentVersion[]
  permissions  DocumentPermission[]
  favorites    Favorite[]
  feedbacks    Feedback[]
  logs         ActivityLog[]

  @@map("document")
}

model DocumentVersion {
  id         Int      @id @default(autoincrement())
  documentId Int      @map("document_id")
  version    String
  fileUrl    String   @map("file_url")
  uploadedBy Int
  uploadedAt DateTime @default(now())

  document   Document @relation(fields: [documentId], references: [id])
  uploader   User     @relation("UploadedVersions", fields: [uploadedBy], references: [id])

  @@map("document_version")

}

model DocumentPermission {
  id         Int @id @default(autoincrement())
  documentId Int  @map("document_id")
  role       String   // HR, Staff, Manager

  document   Document @relation(fields: [documentId], references: [id])
}

model Favorite {
  id         Int @id @default(autoincrement())
  userId     Int
  documentId Int

  user       User     @relation(fields: [userId], references: [id])
  document   Document @relation(fields: [documentId], references: [id])

  @@unique([userId, documentId])
}

model Feedback {
  id         Int      @id @default(autoincrement())
  userId     Int
  documentId Int
  message    String
  createdAt  DateTime @default(now())

  user       User     @relation(fields: [userId], references: [id])
  document   Document @relation(fields: [documentId], references: [id])
}

model ActivityLog {
  id         Int      @id @default(autoincrement())
  userId     Int
  documentId Int?
  action     String
  createdAt  DateTime @default(now())

  user       User      @relation(fields: [userId], references: [id])
  document   Document? @relation(fields: [documentId], references: [id])
}

model Notification {
  id        Int      @id @default(autoincrement())
  userId    Int
  title     String
  message   String
  isRead    Boolean  @default(false)
  createdAt DateTime @default(now())

  user      User     @relation(fields: [userId], references: [id])
}